<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events</title>
    <link rel="stylesheet" href="/frontend/css/event.css">

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
        const eventsList = document.querySelector('.events-list');
        
        // Function to create event element
        function createEventElement(event) {
          const eventItem = document.createElement('div');
          eventItem.className = 'event-item';
          
          // Format date
          const eventDate = new Date(event.date);
          const formattedDate = eventDate.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
          
          eventItem.innerHTML = `
            <h2 class="event-title">${event.title}</h2>
            <p class="event-details">Date: ${formattedDate}</p>
            <p class="event-details">Location: ${event.location}</p>
            <p class="event-details">Category: ${event.category.charAt(0).toUpperCase() + event.category.slice(1)}</p>
            <p class="event-description">${event.description || 'No description available.'}</p>
          `;
          
          eventsList.appendChild(eventItem);
        }
        
        // Function to load events
        async function loadEvents() {
          try {
            eventsList.innerHTML = '<div class="loading">Loading events...</div>';
            
            const response = await fetch('/api/events');
            if (!response.ok) {
              throw new Error('Failed to fetch events');
            }
            
            const events = await response.json();
            
            eventsList.innerHTML = '';
            
            if (events.length === 0) {
              eventsList.innerHTML = '<div class="no-results">No events found.</div>';
              return;
            }
            
            events.forEach(createEventElement);
            
            // Set up filter functionality
            setupFilters(events);
            
          } catch (error) {
            console.error('Error loading events:', error);
            eventsList.innerHTML = '<div class="error">Failed to load events. Please try again later.</div>';
          }
        }
        
        // Function to set up filters
        function setupFilters(allEvents) {
          const searchInput = document.getElementById('search');
          const sortSelect = document.getElementById('sort');
          const categorySelect = document.getElementById('category');
          
          // Populate category select with available categories
          const categories = [...new Set(allEvents.map(event => event.category))];
          categories.forEach(category => {
            if (!categorySelect.querySelector(`option[value="${category}"]`)) {
              const option = document.createElement('option');
              option.value = category;
              option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
              categorySelect.appendChild(option);
            }
          });
          
          // Filter function
          function filterEvents() {
            const searchTerm = searchInput.value.toLowerCase();
            const sortBy = sortSelect.value;
            const categoryFilter = categorySelect.value;
            
            let filteredEvents = [...allEvents];
            
            // Apply search filter
            if (searchTerm) {
              filteredEvents = filteredEvents.filter(event => 
                event.title.toLowerCase().includes(searchTerm) || 
                event.description?.toLowerCase().includes(searchTerm) ||
                event.location.toLowerCase().includes(searchTerm)
              );
            }
            
            // Apply category filter
            if (categoryFilter !== 'all') {
              filteredEvents = filteredEvents.filter(event => event.category === categoryFilter);
            }
            
            // Apply sorting
            if (sortBy === 'date') {
              filteredEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
            } else if (sortBy === 'location') {
              filteredEvents.sort((a, b) => a.location.localeCompare(b.location));
            }
            
            // Update display
            eventsList.innerHTML = '';
            
            if (filteredEvents.length === 0) {
              eventsList.innerHTML = '<div class="no-results">No events match your criteria.</div>';
              return;
            }
            
            filteredEvents.forEach(createEventElement);
          }
          
          // Add event listeners to filter inputs
          searchInput.addEventListener('input', filterEvents);
          sortSelect.addEventListener('change', filterEvents);
          categorySelect.addEventListener('change', filterEvents);
        }
        
        // Load events on page load
        loadEvents();
      });
        </script>
</head>
<body>
    <nav class="navbar">
        <a href="homepage.html">Home</a>
        <a href="internship.html">Internships</a>
        <a href="Signin.html">Sign In</a>
        <a href="Signup.html">Sign Up</a>
        <a href="Admin.html">Admin Login</a>
    </nav>
    <h1 class="page-header">Events</h1>
    <div class="filter-container">
        <label for="search">Search Events:</label>
        <input type="text" id="search" placeholder="Search for events...">
        <label for="sort">Sort By:</label>
        <select id="sort">
            <option value="date">Date</option>
            <option value="location">Location</option>
        </select>
        <label for="category">Filter By Category:</label>
        <select id="category">
            <option value="all">All Categories</option>
            <option value="workshop">Workshop</option>
            <option value="competition">Competition</option>
            <option value="seminar">Seminar</option>
        </select>
    </div>
    <div class="events-list">
        <div class="event-item">
            <h2 class="event-title">Workshop on AI</h2>
            <p class="event-details">Date: 15th April 2025</p>
            <p class="event-details">Location: New York</p>
            <p class="event-details">Category: Workshop</p>
        </div>
        <div class="event-item">
            <h2 class="event-title">Coding Competition</h2>
            <p class="event-details">Date: 20th April 2025</p>
            <p class="event-details">Location: San Francisco</p>
            <p class="event-details">Category: Competition</p>
        </div>
    </div>
</body>
</html>
