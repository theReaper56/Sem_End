<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internships</title>
    <link rel="stylesheet" href="/frontend/css/internship.css">

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
          try {
            const response = await fetch('/api/internships');
            const internships = await response.json();
            
            const internshipsList = document.querySelector('.internships-list');
            internshipsList.innerHTML = '';
            
            internships.forEach(internship => {
              const internshipItem = document.createElement('div');
              internshipItem.className = 'internship-item';
              internshipItem.innerHTML = `
                <h2 class="internship-title">${internship.title}</h2>
                <p class="internship-details">Company: ${internship.company}</p>
                <p class="internship-details">Start Date: ${new Date(internship.start_date).toLocaleDateString()}</p>
                <p class="internship-details">Location: ${internship.location}</p>
                <p class="internship-details">Category: ${internship.category}</p>
                <a href="apply.html?id=${internship.id}" class="internship-button">Apply Now</a>
              `;
              internshipsList.appendChild(internshipItem);
            });
        
            // Filter/Sort functionality
            document.querySelectorAll('select, input').forEach(element => {
              element.addEventListener('change', updateFilters);
            });
        
            async function updateFilters() {
              const search = document.getElementById('search').value.toLowerCase();
              const sortBy = document.getElementById('sort').value;
              const category = document.getElementById('category').value;
        
              const res = await fetch('/api/internships');
              let filteredInternships = await res.json();
        
              filteredInternships = filteredInternships.filter(internship => {
                return (internship.title.toLowerCase().includes(search) &&
                       (category === 'all' || internship.category === category));
              });
        
              filteredInternships.sort((a, b) => {
                if (sortBy === 'date') return new Date(a.start_date) - new Date(b.start_date);
                if (sortBy === 'location') return a.location.localeCompare(b.location);
                return 0;
              });
        
              internshipsList.innerHTML = '';
              filteredInternships.forEach(createInternshipElement);
            }
          } catch (error) {
            console.error('Error loading internships:', error);
          }
        });
        </script>

</head>
<body>
    <nav class="navbar">
        <a href="homepage.html">Home</a>
        <a href="Event.html">Events</a>
        <a href="Signin.html">Sign In</a>
        <a href="Signup.html">Sign Up</a>
        <a href="Admin.html">Admin Login</a>
    </nav>
    <h1 class="page-header">Internship Opportunities</h1>
    <div class="filter-container">
        <label for="search">Search Internships:</label>
        <input type="text" id="search" placeholder="Search for internships...">
        <label for="sort">Sort By:</label>
        <select id="sort">
            <option value="date">Start Date</option>
            <option value="location">Location</option>
        </select>
        <label for="category">Filter By Category:</label>
        <select id="category">
            <option value="all">All Categories</option>
            <option value="technology">Technology</option>
            <option value="marketing">Marketing</option>
            <option value="finance">Finance</option>
        </select>
    </div>
    <div class="internships-list">
        <div class="internship-item">
            <h2 class="internship-title">Software Developer Intern</h2>
            <p class="internship-details">Start Date: 1st May 2025</p>
            <p class="internship-details">Location: New York</p>
            <p class="internship-details">Category: Technology</p>
            <a href="apply.html" class="internship-button">Apply Now</a>
        </div>
        <div class="internship-item">
            <h2 class="internship-title">Digital Marketing Intern</h2>
            <p class="internship-details">Start Date: 10th May 2025</p>
            <p class="internship-details">Location: Los Angeles</p>
            <p class="internship-details">Category: Marketing</p>
            <a href="apply.html" class="internship-button">Apply Now</a>
        </div>
    </div>
</body>
</html>
